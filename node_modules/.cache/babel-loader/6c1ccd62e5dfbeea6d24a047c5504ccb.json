{"ast":null,"code":"var _jsxFileName = \"/Users/peterbak/Documents/GitHub/game1010/game1010/src/widgets/Board.js\",\n    _s = $RefreshSig$();\n\nimport { Box } from '@material-ui/core';\nimport React, { useRef, useLayoutEffect } from 'react';\nimport useStyles from '../style';\nimport * as d3 from 'd3';\nimport { generateStones } from './Stones';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst draw = div => {\n  const config = {\n    size: 40,\n    grid: 10,\n    padding: 2,\n    stones: 43,\n    colors: [\"#8dd3c7\", \"#ffffb3\", \"#bebada\", \"#fb8072\", \"#80b1d3\", \"#fdb462\", \"#b3de69\", \"#fccde5\", \"#d9d9d9\", \"#bc80bd\", \"#ccebc5\", \"#ffed6f\"],\n    colors1: [\"#66c2a5\", \"#fc8d62\", \"#8da0cb\", \"#e78ac3\", \"#a6d854\", \"#ffd92f\", \"#e5c494\", \"#b3b3b3\"]\n  };\n  let s = config.size,\n      p = config.padding,\n      width = config.grid * (s + p),\n      height = width;\n  let col = d3.scaleOrdinal().range(config.colors);\n  const board = d3.range(config.grid).map(r => d3.range(config.grid).map(c => ({\n    x: c * (s + p),\n    y: r * (s + p),\n    free: true\n  })));\n  let stones = generateStones(config.stones);\n  let drawnStones = [];\n  let currentStoneNr = 0,\n      movingStone = 0;\n\n  const snapToGrid = (x, y) => {\n    let pos = {\n      c: Math.max(0, Math.floor(x / (s + p))),\n      r: Math.max(0, Math.floor(y / (s + p)))\n    };\n\n    if (pos.r >= config.grid) {\n      pos.y = height + s * 2;\n      pos.x = (width - s) / 2;\n      pos.c = pos.r = null;\n    } else {\n      pos.y = Math.min(config.grid - 1, pos.r) * (s + p);\n      pos.x = Math.min(config.grid - 1, pos.c) * (s + p);\n    }\n\n    return pos;\n  };\n\n  const checkPosition = pos => {\n    const stn = stones[movingStone].stone;\n    let flag = true;\n    stn.forEach(t => {\n      if (pos.c === null || pos.r === null) {\n        flag = false;\n      } else if (t[0] + pos.c >= config.grid || t[0] + pos.c < 0 || t[1] + pos.r >= config.grid || t[1] + pos.r < 0) {\n        flag = false;\n      } else if (board[t[1] + pos.r][t[0] + pos.c].free === false) {\n        flag = false;\n      }\n    });\n    return flag;\n  };\n\n  const moveStone = (x, y) => {\n    const stn = drawnStones[movingStone];\n    stn.forEach(t => t.attr(\"transform\", \"translate(\" + x + \",\" + y + \")\"));\n  };\n\n  const setPosition = (pos, val) => {\n    const stn = stones[movingStone].stone;\n    stn.forEach(t => {\n      board[t[1] + pos.r][t[0] + pos.c].free = val;\n    });\n    board.map(a => console.info(a.map(b => b.free ? 1 : 0).join(\",\")));\n  };\n\n  function dragstarted(event) {\n    movingStone = +d3.select(this).attr(\"stn\");\n\n    if (movingStone !== currentStoneNr) {\n      movingStone = null;\n    }\n  }\n\n  function dragged(event) {\n    if (movingStone === null) {\n      return;\n    }\n\n    let pos = snapToGrid(event.x, event.y);\n    moveStone(pos.x, pos.y);\n    drawnStones[movingStone].forEach(m => {\n      pos.x = Math.min(pos.x, m.attr(\"x\"));\n      pos.y = Math.min(pos.y, m.attr(\"y\"));\n    });\n    let check = checkPosition(pos);\n    drawnStones[movingStone].forEach(m => {\n      m.attr(\"opacity\", check === false ? 0.5 : 1);\n    });\n  }\n\n  function dragended(event) {\n    if (movingStone === null) {\n      return;\n    }\n\n    let pos = snapToGrid(event.x, event.y);\n    let check = checkPosition(pos);\n\n    if (check === true) {\n      setPosition(pos, false);\n      currentStoneNr++;\n      drawStone();\n    } else {\n      pos = snapToGrid(width, height);\n      moveStone(pos.x, pos.y);\n      drawnStones[movingStone].forEach(m => {\n        m.attr(\"opacity\", 1);\n      });\n    }\n  }\n\n  const drag = d3.drag().on(\"start\", dragstarted).on(\"drag\", dragged).on(\"end\", dragended);\n  d3.select(div).selectAll('*').remove();\n  const svg = d3.select(div).append(\"svg\").attr(\"width\", width + p * 2).attr(\"height\", (height + p) * 2).append(\"g\").attr(\"transform\", \"translate(\" + p + \",\" + p + \")\");\n  let row = svg.selectAll(\".row\").data(board).enter().append(\"g\").attr(\"class\", \"row\");\n  row.selectAll(\".square\").data(d => d).enter().append(\"rect\").attr(\"class\", \"square\").attr(\"x\", d => d.x).attr(\"y\", d => d.y).attr(\"width\", s).attr(\"height\", s).attr(\"rx\", s / 10).attr(\"ry\", s / 10).style(\"fill\", \"#fff\").style(\"stroke\", \"#444\");\n\n  const drawStone = (x = (width - s) / 2, y = height + s * 2) => {\n    const stn = stones[currentStoneNr].stone;\n    const color = stones[currentStoneNr].type;\n    let pieces = [];\n    stn.forEach((cell, i) => {\n      let piece = svg.append(\"rect\").attr(\"class\", \"stn\").attr(\"stn\", currentStoneNr).attr(\"x\", cell[0] * (s + p)).attr(\"y\", cell[1] * (s + p)).attr(\"width\", s).attr(\"height\", s).attr(\"rx\", s / 10).attr(\"ry\", s / 10).style(\"fill\", col(color)).style(\"stroke\", \"#000\").attr(\"transform\", \"translate(\" + x + \",\" + y + \")\").call(drag);\n      pieces.push(piece);\n    });\n    drawnStones.push(pieces);\n  };\n\n  drawStone();\n};\n\nconst Board = () => {\n  _s();\n\n  const classes = useStyles();\n  const widgetRef = useRef(null);\n  useLayoutEffect(() => {\n    draw(widgetRef.current);\n  });\n  return /*#__PURE__*/_jsxDEV(Box, {\n    className: classes.board,\n    ref: widgetRef\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 185,\n    columnNumber: 12\n  }, this);\n};\n\n_s(Board, \"cFDRHWlqjeUjP2b8ZEl5Vn6bhi8=\", false, function () {\n  return [useStyles];\n});\n\n_c = Board;\nexport default Board;\n\nvar _c;\n\n$RefreshReg$(_c, \"Board\");","map":{"version":3,"sources":["/Users/peterbak/Documents/GitHub/game1010/game1010/src/widgets/Board.js"],"names":["Box","React","useRef","useLayoutEffect","useStyles","d3","generateStones","draw","div","config","size","grid","padding","stones","colors","colors1","s","p","width","height","col","scaleOrdinal","range","board","map","r","c","x","y","free","drawnStones","currentStoneNr","movingStone","snapToGrid","pos","Math","max","floor","min","checkPosition","stn","stone","flag","forEach","t","moveStone","attr","setPosition","val","a","console","info","b","join","dragstarted","event","select","dragged","m","check","dragended","drawStone","drag","on","selectAll","remove","svg","append","row","data","enter","d","style","color","type","pieces","cell","i","piece","call","push","Board","classes","widgetRef","current"],"mappings":"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","sourcesContent":["import { Box } from '@material-ui/core'\nimport React, {useRef, useLayoutEffect} from 'react'\n\nimport useStyles from '../style';\nimport * as d3 from 'd3';\nimport { generateStones } from './Stones'\n\nconst draw = (div) => {\n    const config = {\n        size: 40,\n        grid: 10,\n        padding: 2,\n        stones: 43,\n        colors: [\"#8dd3c7\",\"#ffffb3\",\"#bebada\",\"#fb8072\",\"#80b1d3\",\"#fdb462\",\"#b3de69\",\"#fccde5\",\"#d9d9d9\",\"#bc80bd\",\"#ccebc5\",\"#ffed6f\"],\n        colors1: [\"#66c2a5\",\"#fc8d62\",\"#8da0cb\",\"#e78ac3\",\"#a6d854\",\"#ffd92f\",\"#e5c494\",\"#b3b3b3\"]\n    }\n\n    let s = config.size, p=config.padding, width = config.grid * (s + p), height = width;\n    let col = d3.scaleOrdinal().range(config.colors);\n\n    const board = d3.range(config.grid).map((r) => \n        d3.range(config.grid).map((c) => \n            ({\n                x: c * (s + p), \n                y: r * (s + p), \n                free: true \n            })));\n            \n    let stones = generateStones(config.stones)\n    let drawnStones = [];\n    let currentStoneNr = 0, movingStone = 0;\n        \n            \n    const snapToGrid = (x, y) => {\n        let pos = {\n            c: Math.max(0, Math.floor(x / (s + p))),\n            r: Math.max(0, Math.floor(y / (s + p)))\n        }\n        if (pos.r >= config.grid) {\n            pos.y = height + s * 2\n            pos.x = (width - s) / 2\n            pos.c = pos.r = null;\n        } else {\n            pos.y = Math.min(config.grid-1, pos.r) * (s + p)\n            pos.x = Math.min(config.grid-1, pos.c) * (s + p)\n        }\n        return pos\n    }\n\n    const checkPosition = (pos) => {\n        const stn = stones[movingStone].stone\n        let flag = true;\n        stn.forEach(t => {\n            if (pos.c===null || pos.r===null){\n                flag = false\n            } else if (t[0]+pos.c >= config.grid || t[0]+pos.c < 0 || t[1]+pos.r >= config.grid || t[1]+pos.r < 0){\n                flag = false\n            } else if (board[t[1]+pos.r][t[0]+pos.c].free===false){\n                flag = false;\n            }\n        })\n        return flag;\n    }\n\n    const moveStone = (x, y) => {\n        const stn = drawnStones[movingStone];\n        stn.forEach(t => t.attr(\"transform\",\"translate(\"+(x)+\",\"+(y)+\")\"));\n    }\n\n    const setPosition = (pos, val) => {\n        const stn = stones[movingStone].stone\n        stn.forEach(t => {\n            board[t[1]+pos.r][t[0]+pos.c].free = val;\n        });\n        board.map(a => console.info(a.map(b => b.free ? 1 : 0).join(\",\")))\n    }\n\n    function dragstarted(event) {\n        movingStone = +d3.select(this).attr(\"stn\");\n        if (movingStone !== currentStoneNr){\n            movingStone = null; \n        }\n    }\n    \n    function dragged(event) {\n        if (movingStone===null){return;}\n        let pos = snapToGrid(event.x, event.y);\n        moveStone(pos.x, pos.y)\n        drawnStones[movingStone].forEach(m => {\n            pos.x = Math.min(pos.x, m.attr(\"x\"))\n            pos.y = Math.min(pos.y, m.attr(\"y\"))\n        });\n        let check  = checkPosition(pos);\n        drawnStones[movingStone].forEach(m => {\n            m.attr(\"opacity\", check===false ? 0.5 : 1)\n        });\n    }\n    \n    function dragended(event) {\n        if (movingStone===null){return;}\n        let pos = snapToGrid(event.x, event.y);\n        let check  = checkPosition(pos);\n\n        if (check===true){\n            setPosition(pos, false)\n            currentStoneNr++;\n            drawStone();\n        } else {\n            pos = snapToGrid(width, height);\n            moveStone(pos.x, pos.y);\n            drawnStones[movingStone].forEach(m => {\n                m.attr(\"opacity\", 1)\n            });\n        }\n    }\n    \n    const drag = d3.drag()\n          .on(\"start\", dragstarted)\n          .on(\"drag\", dragged)\n          .on(\"end\", dragended);\n\n    d3.select(div).selectAll('*').remove();\n\n    const svg = d3.select(div).append(\"svg\")\n        .attr(\"width\", width + p * 2)\n        .attr(\"height\", (height + p) * 2)\n        .append(\"g\")\n        .attr(\"transform\",\"translate(\"+p+\",\"+p+\")\");\n\n    let row = svg.selectAll(\".row\")\n        .data(board)\n        .enter().append(\"g\")\n        .attr(\"class\", \"row\");\n\n    row.selectAll(\".square\")\n        .data((d) => d)\n        .enter().append(\"rect\")\n        .attr(\"class\",\"square\")\n        .attr(\"x\", (d) => d.x )\n        .attr(\"y\", (d) => d.y )\n        .attr(\"width\", s )\n        .attr(\"height\", s )\n        .attr(\"rx\", s/10)\n        .attr(\"ry\", s/10)\n        .style(\"fill\", \"#fff\")\n        .style(\"stroke\", \"#444\");\n    \n    const drawStone = (x = (width - s) / 2, y = height + s * 2) => {\n        const stn = stones[currentStoneNr].stone;\n        const color = stones[currentStoneNr].type \n        let pieces = []\n        stn.forEach((cell, i) => {\n            let piece = svg.append(\"rect\")\n                .attr(\"class\",\"stn\")\n                .attr(\"stn\", currentStoneNr)\n                .attr(\"x\", cell[0] * (s + p) )\n                .attr(\"y\", cell[1] * (s + p))\n                .attr(\"width\", s )\n                .attr(\"height\", s )\n                .attr(\"rx\", s/10)\n                .attr(\"ry\", s/10)\n                .style(\"fill\", col(color))\n                .style(\"stroke\", \"#000\")\n                .attr(\"transform\",\"translate(\"+(x)+\",\"+(y)+\")\")\n                .call(drag);\n                pieces.push(piece)\n        })\n        drawnStones.push(pieces)\n    }\n\n    drawStone();\n    \n}\n\nconst Board = () => {\n    const classes = useStyles();\n    const widgetRef = useRef(null);\n\n    useLayoutEffect(() => {\n        \n        draw(widgetRef.current);\n        \n    });\n\n    return <Box className={classes.board} ref={widgetRef}>\n        \n    </Box>\n}\n\nexport default Board;"]},"metadata":{},"sourceType":"module"}